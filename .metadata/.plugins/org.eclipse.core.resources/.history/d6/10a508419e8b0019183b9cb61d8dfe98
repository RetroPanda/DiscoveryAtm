package com.discovery.bank.service;

import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.discovery.bank.dto.AccountType;
import com.discovery.bank.dto.ClientAccount;
import com.discovery.bank.dto.Currency;
import com.discovery.bank.model.ClientAccountModel;
import com.discovery.bank.repo.AccountRepository;
import com.discovery.bank.repo.AccountTypeRepository;
import com.discovery.bank.repo.CurrencyRepository;

@Service
public class AtmService {
	@Autowired
	AccountRepository accRepository;
	
	@Autowired
	CurrencyRepository currencyRepository;
	
	@Autowired
	AccountTypeRepository accTypeRepository;
	
	public List<ClientAccount> getAllAccounts() {
		List<ClientAccount> accounts = new ArrayList<ClientAccount>();
		accRepository.findAll().forEach((account) -> accounts.add(account));	
	     return accounts;  
	}

	public List<ClientAccountModel> getCurrencyAccountsByClientId(int id) {
		
			//repository.findAllClientAccountsByCurrencyCode("ZAR").forEach((account) -> accounts.add(account));
	
		
		//Currency curr = currencyRepository.findById(account.getCurrencyCode()).get();
		//===================
		List<ClientAccount> accounts = new ArrayList<ClientAccount>();
		List<ClientAccountModel> accountsToReturn = new ArrayList<ClientAccountModel>();
		
		accRepository.findByClientId(id).forEach((account) -> accounts.add(account));
		
		for(ClientAccount account : accounts) {
			ClientAccountModel clientAccountModel = new ClientAccountModel();
			AccountType accType = accTypeRepository.findById(account.getAccountTypeCode()).get();
			clientAccountModel.setAccountNumber(account.getClientAccountNumber());
			clientAccountModel.setAccountBalance(account.getDisplayBalance().doubleValue());
			clientAccountModel.setAccountType(accType.getDesciption());
			accountsToReturn.add(clientAccountModel);
		}
		accountsToReturn.sort(new Comparator<ClientAccountModel>() {
            @Override
            public int compare(ClientAccountModel account1, ClientAccountModel account2) {
            	return account1.getAccountBalance().compareTo(account2.getAccountBalance());
             }
        });
		return accountsToReturn;
	}
	
	public List<ClientAccountModel> getTransactionalAccountsByClientId(int id) {
		
		List<ClientAccount> accounts = new ArrayList<ClientAccount>();
		List<ClientAccountModel> accountsToReturn = new ArrayList<ClientAccountModel>();
		//TODO get properly
		accRepository.findByClientId(id).forEach((account) -> accounts.add(account));
		
		for(ClientAccount account : accounts) {
			ClientAccountModel clientAccountModel = new ClientAccountModel();
			AccountType accType = accTypeRepository.findById(account.getAccountTypeCode()).get();
			clientAccountModel.setAccountNumber(account.getClientAccountNumber());
			clientAccountModel.setAccountBalance(account.getDisplayBalance().doubleValue());
			clientAccountModel.setAccountType(accType.getDesciption());
			accountsToReturn.add(clientAccountModel);
		}
		accountsToReturn.sort(new Comparator<ClientAccountModel>() {
            @Override
            public int compare(ClientAccountModel account1, ClientAccountModel account2) {
            	return account1.getAccountBalance().compareTo(account2.getAccountBalance());
             }
        });
		return accountsToReturn;
	}

}
